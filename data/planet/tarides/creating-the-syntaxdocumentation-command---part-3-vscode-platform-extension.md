---
title: 'Creating the SyntaxDocumentation Command - Part 3: VSCode Platform Extension'
description: Discover how `SyntaxDocumentation` became an opt-in feature within the
  OCaml VSCode Platform extension, enhancing configuration in the VSCode editor.
url: https://tarides.com/blog/2024-07-24-creating-the-syntaxdocumentation-command-part-3-vscode-platform-extension
date: 2024-07-24T00:00:00-00:00
preview_image: https://tarides.com/blog/images/vscode_toggle-1360w.webp
featured:
authors:
- Tarides
source:
---

<p>In the final installment of our series on the <code>SyntaxDocumentation</code> command, we delve into its integration within the OCaml VSCode Platform extension. Building on our previous discussions about Merlin and OCaml LSP, this article explores how to make <code>SyntaxDocumentation</code> an opt-in feature in the popular VSCode editor.</p>
<p>In the first part of this series, <a href="https://tarides.com/blog/2024-04-17-creating-the-syntaxdocumentation-command-part-1-merlin/">Creating the SyntaxDocumentation Command - Part 1: Merlin</a>, we explored how to create a new command in Merlin, particularly the <code>SyntaxDocumentation</code> command. In the second part, <a href="https://tarides.com/blog/2024-06-12-creating-the-syntaxdocumentation-command-part-2-ocaml-lsp/">Creating the SyntaxDocumentation Command - Part 2: OCaml LSP</a>, we looked at how to implement this feature in OCaml LSP in order to enable visual editors to trigger the command with actions such as hovering. In this third and final installment, you will learn how <code>SyntaxDocumentation</code> integrates into the OCaml VSCode Platform extension as an opt-in feature, enabling users to toggle it on/off depending on their preference.</p>
<h2>VSCode Editor</h2>
<p><a href="https://code.visualstudio.com/">Visual Studio Code</a> is a free open-source, cross-platform code editor from Microsoft that is very popular among developers.
Some of its features include:</p>
<ul>
<li>Built-in Git support</li>
<li>Easy debugging of code right from the editor with an interactive console</li>
<li>Built-in extension manager with lots of available extensions to download</li>
<li>Supports a huge number of programming languages, including syntax highlighting</li>
<li>Integrated terminal and many more features</li>
</ul>
<h2>OCaml Platform Extension for VSCode</h2>
<p>The VSCode OCaml Platform extension enhances the development experience for OCaml programmers. It is itself written in the OCaml programming language using bindings to the VSCode API and then compiled into Javascript with <a href="https://github.com/ocsigen/js_of_ocaml"><code>js_of_ocaml</code></a>. It provides language support features such as <code>syntax-highlighting</code>, <code>go-to-definition</code>, <code>auto-completion</code>, and <code>type-on-hover</code>. These key functionalities are powered by the OCaml Language Server (<code>ocamllsp</code>), which can be installed using popular package managers like <a href="https://opam.ocaml.org/">opam</a> and <a href="https://esy.sh/">esy</a>. Users can easily configure the extension to work with different sandbox environments, ensuring a tailored setup for various project needs. Additionally, the extension includes comprehensive settings and command options, making it very versatile for both beginner and advanced OCaml developers.</p>
<p>The OCaml Platform Extension for VSCode gives us a nice UI for interacting with OCaml-LSP. We can configure settings for the server as well as interact with switches, browse the AST, and many more features. Our main focus is on adding a <code>checkbox</code> that allows users to activate or deactivate <code>SyntaxDocumentation</code> in OCaml LSP's <code>hover</code> response. I limited this article's scope to just the files relevant in implementing this, while giving a brief tour of how the extension is built.</p>
<h2>The Implementation</h2>
<h3>Extension Manifest</h3>
<p>Every VSCode extension has a manifest file, <a href="https://github.com/ocamllabs/vscode-ocaml-platform/blob/master/package.json">package.json</a>, at the root of the extension directory. The <code>package.json</code> contains a mix of Node.js fields, such as scripts and <code>devDependencies</code>, and VS Code specific fields, like <code>publisher</code>, <code>activationEvents</code>, and <code>contributes</code>.
Our manifest file contains general information such as:</p>
<ul>
<li><strong>Name</strong>: OCaml Platform</li>
<li><strong>Description</strong>: Official OCaml language extension for VSCode</li>
<li><strong>Version</strong>: 1.14.2</li>
<li><strong>Publisher</strong>: OCaml Labs</li>
<li><strong>Categories</strong>: Programming Languages, Debuggers</li>
</ul>
<p>We also have commands that act as action events for our extension. These commands are used to perform a wide range of things, like navigating the AST, upgrading packages, deleting a switch, etc.
An example of a command to open the AST explorer is written as:</p>
<pre><code class="language-json">{
    &quot;command&quot;: &quot;ocaml.open-ast-explorer-to-the-side&quot;,
    &quot;category&quot;: &quot;OCaml&quot;,
    &quot;title&quot;: &quot;Open AST explorer&quot;
}
</code></pre>
<p>For our case, enabling/disabling <code>SyntaxDocumentation</code> is a configuration setting for our language server, so we indicate this in the configurations section:</p>
<pre><code class="language-json">&quot;ocaml.server.syntaxDocumentation&quot;: {
    &quot;type&quot;: &quot;boolean&quot;,
    &quot;default&quot;: false,
    &quot;markdownDescription&quot;: &quot;Enable/Disable syntax documentation&quot;
}
</code></pre>
<h3>Extension Instance</h3>
<p>The file <a href="https://github.com/ocamllabs/vscode-ocaml-platform/blob/master/src/extension_instance.ml"><code>extension_instance.ml</code></a> handles the setup and configuration of various components of the OCaml VSCode extension and ensures that features like the language server and documentation are properly initialised. Its key functionalities are:</p>
<ul>
<li><strong>Managing the Extension State</strong>: It uses a record type that encapsulates the state of the extension, holding information about the sandbox, REPL, OCaml version, LSP client, documentation server, and various other settings.</li>
</ul>
<pre><code><span class="ocaml-keyword-other">type</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">{</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">sandbox</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Sandbox</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">repl</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Terminal_sandbox</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-source">option</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">ocaml_version</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Ocaml_version</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-source">option</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">lsp_client</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-source">(</span><span class="ocaml-constant-language-capital-identifier">LanguageClient</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">*</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Ocaml_lsp</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source">)</span><span class="ocaml-source"> </span><span class="ocaml-source">option</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">documentation_server</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Documentation_server</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-source">option</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-source">documentation_server_info</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">StatusBarItem</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-source">sandbox_info</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">StatusBarItem</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-source">ast_editor_state</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Ast_editor_state</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">codelens</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-support-type">bool</span><span class="ocaml-source"> </span><span class="ocaml-source">option</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">extended_hover</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-support-type">bool</span><span class="ocaml-source"> </span><span class="ocaml-source">option</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">dune_diagnostics</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-support-type">bool</span><span class="ocaml-source"> </span><span class="ocaml-source">option</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">mutable</span><span class="ocaml-source"> </span><span class="ocaml-source">syntax_documentation</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-support-type">bool</span><span class="ocaml-source"> </span><span class="ocaml-source">option</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">}</span><span class="ocaml-source">
</span></code></pre>
<ul>
<li>
<p><strong>Interacting With the Language Server</strong>: This extension needs to interact with the OCaml language server (<code>ocamllsp</code>) to provide features like code completion, diagnostics, and other language-specific functionalities.</p>
</li>
<li>
<p><strong>Documentation Server Management</strong>: The file includes functionality to start, stop, and manage the documentation server, which provides documentation lookup for installed OCaml packages.</p>
</li>
<li>
<p><strong>Handling Configuration</strong>: This extension allows users to configure settings such as code lens, extended hover, diagnostics, and syntax documentation. These settings are sent to the language server to adjust its behaviour accordingly. For <code>SyntaxDocumentation</code>, whenever the user toggles the checkbox, the server should set the correct configuration parameters. This is done mainly using two functions <code>set_configuration</code> and <code>send_configuration</code>.</p>
</li>
</ul>
<pre><code><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span><span class="ocaml-source">
</span><span class="ocaml-comment-block">(*</span><span class="ocaml-comment-block"> Set configuration </span><span class="ocaml-comment-block">*)</span><span class="ocaml-source">
</span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">set_configuration</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> ~</span><span class="ocaml-source">syntax_documentation</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-source">t</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">syntax_documentation</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">&lt;-</span><span class="ocaml-source"> </span><span class="ocaml-source">syntax_documentation</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">match</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">lsp_client</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">with</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">|</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">None</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-unit">()</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">|</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Some</span><span class="ocaml-source"> </span><span class="ocaml-source">(</span><span class="ocaml-source">client</span><span class="ocaml-keyword-other-ocaml punctuation-comma punctuation-separator">,</span><span class="ocaml-source"> </span><span class="ocaml-source">(</span><span class="ocaml-constant-language">_</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Ocaml_lsp</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source">)</span><span class="ocaml-source">)</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source">
</span><span class="ocaml-source">      </span><span class="ocaml-source">send_configuration</span><span class="ocaml-source"> ~</span><span class="ocaml-source">syntax_documentation</span><span class="ocaml-source"> </span><span class="ocaml-source">client</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span></code></pre>
<pre><code><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span><span class="ocaml-source">
</span><span class="ocaml-comment-block">(*</span><span class="ocaml-comment-block"> Send configuration </span><span class="ocaml-comment-block">*)</span><span class="ocaml-source">
</span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">send_configuration</span><span class="ocaml-source"> </span><span class="ocaml-source">~</span><span class="ocaml-source">syntax_documentation</span><span class="ocaml-source"> </span><span class="ocaml-source">client</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">syntaxDocumentation</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-constant-language-capital-identifier">Option</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">map</span><span class="ocaml-source"> </span><span class="ocaml-source">syntax_documentation</span><span class="ocaml-source"> ~</span><span class="ocaml-source">f</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source">(</span><span class="ocaml-keyword-other">fun</span><span class="ocaml-source"> </span><span class="ocaml-source">enable</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source">
</span><span class="ocaml-source">        </span><span class="ocaml-constant-language-capital-identifier">Ocaml_lsp</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">OcamllspSettingEnable</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">create</span><span class="ocaml-source"> ~</span><span class="ocaml-source">enable</span><span class="ocaml-source">)</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">settings</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-constant-language-capital-identifier">Ocaml_lsp</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">OcamllspSettings</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">create</span><span class="ocaml-source">
</span><span class="ocaml-source">      ~</span><span class="ocaml-source">syntaxDocumentation</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">payload</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">settings</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">      </span><span class="ocaml-constant-language-capital-identifier">LanguageClient</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">DidChangeConfiguration</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">create</span><span class="ocaml-source">
</span><span class="ocaml-source">        ~</span><span class="ocaml-source">settings</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source">(</span><span class="ocaml-constant-language-capital-identifier">Ocaml_lsp</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">OcamllspSettings</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t_to_js</span><span class="ocaml-source"> </span><span class="ocaml-source">settings</span><span class="ocaml-source">)</span><span class="ocaml-source">
</span><span class="ocaml-source">        </span><span class="ocaml-constant-language-unit">()</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-constant-language-capital-identifier">LanguageClient</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">DidChangeConfiguration</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t_to_js</span><span class="ocaml-source"> </span><span class="ocaml-source">settings</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-constant-language-capital-identifier">LanguageClient</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">sendNotification</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-source">client</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-string-quoted-double">&quot;</span><span class="ocaml-string-quoted-double">workspace/didChangeConfiguration</span><span class="ocaml-string-quoted-double">&quot;</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-source">payload</span><span class="ocaml-source">
</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span></code></pre>
<h3>Interacting With OCaml LSP:</h3>
<p>The <a href="https://github.com/ocamllabs/vscode-ocaml-platform/blob/master/src/ocaml_lsp.ml"><code>ocaml_lsp.ml</code></a> file ensures that <code>ocamllsp</code> is set up correctly and up to date. For <code>SyntaxDocumentation</code>, two important modules used from this file are: <code>OcamllspSettingEnable</code> and <code>OcamllspSettings</code>.</p>
<p><code>OcamllspSettingEnable</code> defines an interface for enabling/disabling specific settings in <code>ocamllsp</code>.</p>
<pre><code><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other">module</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">OcamllspSettingEnable</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">struct</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">include</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Interface</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Make</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-unit">()</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">include</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-source">[</span><span class="ocaml-keyword-operator-extension">%</span><span class="ocaml-keyword-other-extension">js</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-keyword-other">val</span><span class="ocaml-source"> </span><span class="ocaml-source">enable</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source"> </span><span class="ocaml-support-type">bool</span><span class="ocaml-source"> </span><span class="ocaml-source">or_undefined</span><span class="ocaml-source"> </span><span class="ocaml-source">[</span><span class="ocaml-keyword-operator-attribute">@@</span><span class="ocaml-keyword-other-attribute">js.get</span><span class="ocaml-source">]</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-keyword-other">val</span><span class="ocaml-source"> </span><span class="ocaml-source">create</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-source">enable</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-support-type">bool</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-source">[</span><span class="ocaml-keyword-operator-attribute">@@</span><span class="ocaml-keyword-other-attribute">js.builder</span><span class="ocaml-source">]</span><span class="ocaml-source">]</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other">end</span><span class="ocaml-source">
</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span></code></pre>
<p>The annotation <code>[@@js.get]</code> is a PPX used to bind OCaml functions to JavaScript property accessors. This allows OCaml code to interact seamlessly with JavaScript objects, accessing properties directly as if they were native OCaml fields, while <code>[@@js.builder]</code> facilitates the creation of JavaScript objects from OCaml functions. They both come from the <a href="https://github.com/LexiFi/gen_js_api/tree/master"><code>LexFi/gen_js_api</code></a> library.</p>
<p><code>OcamllspSettings</code> aggregrates multiple <code>OcamllspSettingEnable</code> settings into a comprehensive settings interface for <code>ocamllsp</code>.</p>
<pre><code><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other">module</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">OcamllspSettings</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other">struct</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">include</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-capital-identifier">Interface</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Make</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-unit">()</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword-other">include</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-source">[</span><span class="ocaml-keyword-operator-extension">%</span><span class="ocaml-keyword-other-extension">js</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-keyword-other">val</span><span class="ocaml-source"> </span><span class="ocaml-source">syntaxDocumentation</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source">
</span><span class="ocaml-source">      </span><span class="ocaml-constant-language-capital-identifier">OcamllspSettingEnable</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-source">or_undefined</span><span class="ocaml-source"> </span><span class="ocaml-source">[</span><span class="ocaml-keyword-operator-attribute">@@</span><span class="ocaml-keyword-other-attribute">js.get</span><span class="ocaml-source">]</span><span class="ocaml-source">
</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-keyword-other">val</span><span class="ocaml-source"> </span><span class="ocaml-source">create</span><span class="ocaml-source"> </span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source"> ?</span><span class="ocaml-source">syntaxDocumentation</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-language-capital-identifier">OcamllspSettingEnable</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source">
</span><span class="ocaml-source">      </span><span class="ocaml-support-type">unit</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source"> </span><span class="ocaml-source">t</span><span class="ocaml-source"> </span><span class="ocaml-source">[</span><span class="ocaml-keyword-operator-attribute">@@</span><span class="ocaml-keyword-other-attribute">js.builder</span><span class="ocaml-source">]</span><span class="ocaml-source">]</span><span class="ocaml-source">
</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">create</span><span class="ocaml-source"> </span><span class="ocaml-source">~</span><span class="ocaml-source">syntaxDocumentation</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source"> </span><span class="ocaml-source">create</span><span class="ocaml-source"> ?</span><span class="ocaml-source">syntaxDocumentation</span><span class="ocaml-source"> </span><span class="ocaml-constant-language-unit">()</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other">end</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span></code></pre>
<h3>Workspace Configuration</h3>
<p>The file <a href="https://github.com/ocamllabs/vscode-ocaml-platform/blob/master/src/settings.ml"><code>settings.ml</code></a> provides a flexible way to manage workspace-specific settings, including:</p>
<ul>
<li>Creating settings with JSON serialisation and deserialisation</li>
<li>Retrieving and updating settings from the workspace configuration</li>
<li>Resolving and substituting workspace variables within settings</li>
<li>Defining specific settings for the OCaml language server, such as extra environment variables, server arguments, and features like <code>codelens</code> and <code>SyntaxDocumentation</code></li>
</ul>
<pre><code><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">create_setting</span><span class="ocaml-source"> </span><span class="ocaml-source">~</span><span class="ocaml-source">scope</span><span class="ocaml-source"> ~</span><span class="ocaml-source">key</span><span class="ocaml-source"> ~</span><span class="ocaml-source">of_json</span><span class="ocaml-source"> ~</span><span class="ocaml-source">to_json</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-source">{</span><span class="ocaml-source"> </span><span class="ocaml-source">scope</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">key</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">to_json</span><span class="ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator">;</span><span class="ocaml-source"> </span><span class="ocaml-source">of_json</span><span class="ocaml-source"> </span><span class="ocaml-source">}</span><span class="ocaml-source">
</span><span class="ocaml-source">
</span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">server_syntaxDocumentation_setting</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-source">create_setting</span><span class="ocaml-source">
</span><span class="ocaml-source">    ~</span><span class="ocaml-source">scope</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-language-capital-identifier">ConfigurationTarget</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Workspace</span><span class="ocaml-source">
</span><span class="ocaml-source">    ~</span><span class="ocaml-source">key</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-string-quoted-double">&quot;</span><span class="ocaml-string-quoted-double">ocaml.server.syntaxDocumentation</span><span class="ocaml-string-quoted-double">&quot;</span><span class="ocaml-source">
</span><span class="ocaml-source">    ~</span><span class="ocaml-source">of_json</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-language-capital-identifier">Jsonoo</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Decode</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-support-type">bool</span><span class="ocaml-source">
</span><span class="ocaml-source">    ~</span><span class="ocaml-source">to_json</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-constant-language-capital-identifier">Jsonoo</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-constant-language-capital-identifier">Encode</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-support-type">bool</span><span class="ocaml-source">
</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">
</span></code></pre>
<h3>Activating the Extension</h3>
<p>The <a href="https://github.com/ocamllabs/vscode-ocaml-platform/blob/master/src/vscode_ocaml_platform.ml"><code>vscode_ocaml_platform.ml</code></a> file initialises and activates the OCaml Platform extension for VSCode. The key tasks include:</p>
<ul>
<li>Suggesting users select a sandbox environment</li>
<li>Notifying the extension instance of configuration changes</li>
<li>Registering various components and features of the extension</li>
<li>Setting up the sandbox environment and starting the OCaml language server</li>
</ul>
<p>In the context of <code>SyntaxDocumentation</code>, this code ensures that the extension is correctly configured to handle <code>SyntaxDocumentation</code> settings. The <code>notify_configuration_changes</code> function listens for changes to the <code>server_syntaxDocumentation_setting</code> and updates the extension instance accordingly. This means that any changes the user makes to the <code>SyntaxDocumentation</code> settings in the VSCode workspace configuration will be reflected in the extension's behaviour, ensuring that <code>SyntaxDocumentation</code> is enabled or disabled as per the user's preference.</p>
<pre><code><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">notify_configuration_changes</span><span class="ocaml-source"> </span><span class="ocaml-source">instance</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">  </span><span class="ocaml-constant-language-capital-identifier">Workspace</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">onDidChangeConfiguration</span><span class="ocaml-source">
</span><span class="ocaml-source">    ~</span><span class="ocaml-source">listener</span><span class="ocaml-keyword-other-ocaml punctuation-other-colon punctuation">:</span><span class="ocaml-source">(</span><span class="ocaml-keyword-other">fun</span><span class="ocaml-source"> </span><span class="ocaml-source">_event</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">-&gt;</span><span class="ocaml-source">
</span><span class="ocaml-source">      </span><span class="ocaml-keyword">let</span><span class="ocaml-source"> </span><span class="ocaml-entity-name-function-binding">syntax_documentation</span><span class="ocaml-source"> </span><span class="ocaml-keyword-operator">=</span><span class="ocaml-source">
</span><span class="ocaml-source">        </span><span class="ocaml-constant-language-capital-identifier">Settings</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">(</span><span class="ocaml-source">get</span><span class="ocaml-source"> </span><span class="ocaml-source">server_syntaxDocumentation_setting</span><span class="ocaml-source">)</span><span class="ocaml-source">
</span><span class="ocaml-source">      </span><span class="ocaml-keyword-other">in</span><span class="ocaml-source">
</span><span class="ocaml-source">      </span><span class="ocaml-constant-language-capital-identifier">Extension_instance</span><span class="ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator">.</span><span class="ocaml-source">set_configuration</span><span class="ocaml-source"> </span><span class="ocaml-source">instance</span><span class="ocaml-source"> ~</span><span class="ocaml-source">syntax_documentation</span><span class="ocaml-source">)</span><span class="ocaml-source">
</span><span class="ocaml-source">    </span><span class="ocaml-constant-language-unit">()</span><span class="ocaml-source">
</span></code></pre>
<h2>Conclusion</h2>
<p><img src="https://tarides.com/blog/images/syndoc_vscode-1360w~9uZkladGj6eisIBkUICWNA.webp" sizes="(min-width: 1360px) 1360px, (min-width: 680px) 680px, 100vw" srcset="/blog/images/syndoc_vscode-170w~NN9sER4Z0rlmoMgp6BvutQ.webp 170w, /blog/images/syndoc_vscode-340w~zDt2qySNFTX1tRgr-fVleA.webp 340w, /blog/images/syndoc_vscode-680w~GGS8N6GsNA7aAGKArlsb7A.webp 680w, /blog/images/syndoc_vscode-1360w~9uZkladGj6eisIBkUICWNA.webp 1360w" alt="SyntaxDocument toggle"/></p>
<p>In this final article, we explored how to integrate <code>SyntaxDocumentation</code> into OCaml VSCode Platform extension as a configurable option for OCaml LSP's <code>hover</code> command. We covered key components such as configuring the extension manifest, managing the extension state, interacting with the OCaml language server, and handling workspace configurations. By enabling users to toggle the <code>SyntaxDocumentation</code> feature on or off, we can ensure a flexible and customisable development experience for all users.</p>
<p>Feel free to contribute to this extension on the GitHub repository: <a href="https://github.com/ocamllabs/vscode-ocaml-platform"><code>vscode-ocaml-platform</code></a>. Thank you for following along in this series, and happy coding with OCaml and VSCode!</p>

